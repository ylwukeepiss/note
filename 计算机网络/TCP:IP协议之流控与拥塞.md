# TCP/IP协议之流量控制与拥塞控制
## 流量控制
### 作用于接收者，如果发送者发送太多太快，那么接收者来不及接收，将导致数据丢失，因此需要流控，具体实现是滑动窗口协议，接收方返回的ack包中会返回自己能接收的窗口大小，如果为0，发送者停止发送，并启动定时器，若定时器时间未到便收到接收方ACK包中窗口大小，则继续按窗口大小进行发送，时间一到便继续主动询问接收方窗口大小，如果为0则继续重置定时器继续等待，如果不为0则表示接收方ACK包已丢失，此时重制发送窗口大小进行继续发送。（定时器机制的存在，是为了防止接收方ACK包已发送，但因网络问题而丢失，发送方一直等待ACK包获取窗口大小，接收方误以为ACK包已被收到，等待接收数据，从而处于死锁状态）。
## 拥塞控制
### 与流控的区别在于，拥塞控制是作用于网络的，防止过多数据注入到网络中，导致网络负载过大；
### 常用的算法是 （1）慢启动 、拥塞避免 （2）快重传、快速恢复
### （1）慢启动：发送方维护一个 拥塞窗口cwnd，一开始并不发送太多数据，每收到一个接收方的ack包，cwnd+1。
### （2）拥塞避免：为了避免慢启动指数增长过快，需要加入一个门限ssthresh，当cwnd > ssthresh时，采用拥塞避免算法，即每经过一个RTT时间，让cwnd+1，而不是每收到一个ack包cwnd便+1，让拥塞窗口按线性增长。
###  不管是慢启动还是拥塞避免，在这个发送过程中，只要发送方判定出现网络拥塞（没有按时收到确认），则立刻将门限ssthresh重置为原来的一半（乘法减小），将cwnd重置为1（不重置为1的情况是快恢复，具体情况具体实施），继续进行缓慢增长（加法增加）。
### (3)快重传：接收方有一个序列号为x的包未收到时，便会继续重复应答 x-1，当发送方连续收到同一个应答序列号3次时，便会重传这个包。
### (4)快恢复：因为出现丢包，发送方为了预防出现网络拥塞，将ssthresh设置为原值的一半（乘法减小），但因为发送方觉得能连续收到3个相同序列应答包，网络可能并不会出现网络拥塞，因此不重置cwnd的值为1，而是将cwnd设置为当前ssthresh值，接下去并不打算使用慢启动算法，因为已经出现丢包情况了，不打算再给网络造成过多负载，因此执行拥塞避免算法（加法增长）。
## 总的来说，只要包没有及时收到，发送方就判定为出现网络拥塞，此时先降门限，再降cwnd，然后执行拥塞避免算法，缓慢增长单次发送数量；慢启动算法与拥塞避免算法，从表象上看，是单次发包指数增长与线性缓慢增长的区别，算法的使用取决于单次发包数量与门限值ssthresh的比较。